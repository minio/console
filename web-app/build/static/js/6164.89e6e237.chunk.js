"use strict";(self.webpackChunkweb_app=self.webpackChunkweb_app||[]).push([[6164],{96164:(e,s,l)=>{l.r(s),l.d(s,{default:()=>v});var n=l(65043),t=l(89923),i=l(22166),o=l(21383),r=l(32511),a=l(3883),d=l(64159),c=l(64681),x=l(20649),g=l(24241),h=l(33097),p=l.n(h),j=l(70579);const m="HH:mm:ss ZZZZ MM/dd/yyyy",u=e=>{const{log:s}=e,[l,i]=(0,n.useState)(!1),o=e=>p()(s,e,"");let r="",a=o("ConsoleMsg"),d=o("error.message");""!==a?r=a:""!==d&&(r=d);let c=(r||"").replace(/\u2501|\u250f|\u2513|\u2503|\u2517|\u251b/g,"");c=c.replace(/([^\x20-\x7F])/g,"");let x=(0,j.jsx)(n.Fragment,{});""!==a?x=(e=>{let s=e.ConsoleMsg;return s=s.replace(/\x1B/g," "),s=s.replace(/((\[[0-9;]+m))/g,""),(0,j.jsx)("div",{style:{display:"table",tableLayout:"fixed",width:"100%",paddingLeft:10,paddingRight:10},children:(0,j.jsx)("div",{style:{display:"table-cell",whiteSpace:"nowrap",textOverflow:"ellipsis",overflowX:"auto"},children:(0,j.jsx)("pre",{children:s})})})})(s):""!==d&&(x=(e=>{const s={color:"#C83B51",fontWeight:400,fontFamily:"monospace",fontSize:"12px"},l={fontFamily:"monospace",fontSize:"12px"},t=s=>p()(e,s,""),i=g.c9.fromFormat(e.time.toString(),"HH:mm:ss z MM/dd/yyyy",{zone:"UTC"});return(0,j.jsxs)(n.Fragment,{children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("b",{style:l,children:"API:\xa0"}),(0,j.jsx)("span",{style:s,children:t("api.name")})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("b",{style:l,children:"Time:\xa0"}),(0,j.jsx)("span",{style:s,children:i.toFormat(m)})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("b",{style:l,children:"DeploymentID:\xa0"}),(0,j.jsx)("span",{style:s,children:t("deploymentid")})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("b",{style:l,children:"RequestID:\xa0"}),(0,j.jsx)("span",{style:s,children:t("requestID")})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("b",{style:l,children:"RemoteHost:\xa0"}),(0,j.jsx)("span",{style:s,children:t("remotehost")})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("b",{style:l,children:"UserAgent:\xa0"}),(0,j.jsx)("span",{style:s,children:t("userAgent")})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("b",{style:l,children:"Error:\xa0"}),(0,j.jsx)("span",{style:s,children:t("error.message")})]}),(0,j.jsx)("br",{}),(0,j.jsx)("div",{children:(0,j.jsx)("b",{style:l,children:"Backtrace:\xa0"})}),(e.error.source||[]).map(((e,n)=>(0,j.jsxs)("div",{children:[(0,j.jsxs)("b",{style:l,children:[n,":\xa0"]}),(0,j.jsx)("span",{style:s,children:e})]})))]})})(s)),c=(c||"").replace(/((\[[0-9;]+m))/g,"");const h=g.c9.fromFormat(s.time.toString(),"HH:mm:ss z MM/dd/yyyy",{zone:"UTC"}),u=h.toJSDate();let y=(0,j.jsx)(n.Fragment,{children:h.toFormat(m)});return 1===u.getFullYear()&&(y=(0,j.jsx)(n.Fragment,{children:"n/a"})),(0,j.jsxs)(n.Fragment,{children:[(0,j.jsxs)(t.Hjg,{sx:{cursor:"pointer",borderLeft:"0",borderRight:"0"},children:[(0,j.jsx)(t.nA6,{onClick:()=>i(!l),sx:{width:280,color:"#989898",fontSize:12},children:(0,j.jsxs)(t.azJ,{sx:{display:"flex",gap:1,alignItems:"center","& .min-icon":{width:12,marginRight:1},fontWeight:"bold",lineHeight:1},children:[(0,j.jsx)(t.uwE,{}),(0,j.jsx)("div",{children:y})]})}),(0,j.jsx)(t.nA6,{onClick:()=>i(!l),sx:{width:200,color:"#989898",fontSize:12},children:(0,j.jsx)(t.azJ,{sx:{"& .min-icon":{width:12,marginRight:1},fontWeight:"bold",lineHeight:1},children:s.errKind})}),(0,j.jsx)(t.nA6,{onClick:()=>i(!l),children:(0,j.jsx)(t.azJ,{sx:{display:"table",tableLayout:"fixed",width:"100%",paddingLeft:10,paddingRight:10},children:(0,j.jsx)(t.azJ,{sx:{display:"table-cell",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},children:c})})}),(0,j.jsx)(t.nA6,{onClick:()=>i(!l),sx:{width:40},children:(0,j.jsx)(t.azJ,{sx:{"& .min-icon":{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"2px"},"&:hover .min-icon":{fill:"#eaeaea"}},children:l?(0,j.jsx)(t.Clq,{}):(0,j.jsx)(t.FZk,{})})})]}),l?(0,j.jsxs)(t.Hjg,{children:[(0,j.jsx)(t.nA6,{sx:{paddingBottom:0,paddingTop:0,width:200,textTransform:"uppercase",verticalAlign:"top",textAlign:"right",color:"#8399AB",fontWeight:"bold"},children:(0,j.jsx)(t.azJ,{sx:{marginTop:10},children:"Log Details"})}),(0,j.jsx)(t.nA6,{sx:{paddingBottom:0,paddingTop:0},colSpan:2,children:(0,j.jsx)(t.azJ,{sx:{margin:1,padding:4,fontSize:14},withBorders:!0,useBackground:!0,children:x})}),(0,j.jsx)(t.nA6,{sx:{paddingBottom:0,paddingTop:0,width:40}})]}):null]},h.toString())};var y=l(48793),b=l(88617),f=null;const v=()=>{const e=(0,o.jL)(),s=(0,i.d4)((e=>e.logs.logMessages)),l=(0,i.d4)((e=>e.logs.logsStarted)),[g,h]=(0,n.useState)(""),[p,m]=(0,n.useState)([""]),[v,A]=(0,n.useState)("all"),[w,S]=(0,n.useState)("Select user agent"),[C,k]=(0,n.useState)(["All User Agents"]),[z,L]=(0,n.useState)("all"),[F,B]=(0,n.useState)(!1),I=g.toLowerCase();let M=s.filter((e=>(e.userAgent===w||"All User Agents"===w||"Select user agent"===w)&&(""===g||(e.ConsoleMsg.toLowerCase().indexOf(I)>=0||(!!(e.error&&e.error.source&&e.error.source.filter((e=>e.toLowerCase().indexOf(I)>=0)).length>0)||(!!(e.error&&e.error.message.toLowerCase().indexOf(I)>=0)||!!(e.api&&e.api.name.toLowerCase().indexOf(I)>=0)))))));return(0,n.useEffect)((()=>{B(!0),x.A.invoke("GET","/api/v1/nodes").then((e=>{m(e),B(!1)})).catch((e=>{B(!1)}))}),[]),(0,n.useEffect)((()=>{e((0,d.ph)("error_logs"))}),[]),(0,j.jsxs)(n.Fragment,{children:[(0,j.jsx)(y.A,{label:"Logs",actions:(0,j.jsx)(b.A,{})}),(0,j.jsx)(t.Mxu,{children:(0,j.jsxs)(t.xA9,{container:!0,sx:{gap:15},children:[(0,j.jsx)(t.xA9,{item:!0,xs:3,children:F?(0,j.jsx)("h3",{children:" Loading nodes"}):(0,j.jsx)(t.l6P,{id:"node-selector",name:"node","data-test-id":"node-selector",value:v,onChange:e=>{A(e)},disabled:F||l,options:[{label:"All Nodes",value:"all"},...p.map((e=>({label:e,value:e})))]})}),(0,j.jsx)(t.xA9,{item:!0,xs:3,children:(0,j.jsx)(t.l6P,{id:"logType",name:"logType","data-test-id":"log-type",value:z,onChange:e=>{L(e)},disabled:F||l,options:[{value:"all",label:"All Log Types"},{value:"minio",label:"MinIO"},{value:"application",label:"Application"}]})}),(0,j.jsx)(t.xA9,{item:!0,xs:3,children:C.length>1&&(0,j.jsx)(t.l6P,{id:"userAgent",name:"userAgent","data-test-id":"user-agent",value:w,onChange:e=>{S(e)},disabled:C.length<1||l,options:C.map((e=>({label:e,value:e})))})}),(0,j.jsxs)(t.xA9,{item:!0,xs:2,sx:{display:"flex",justifyContent:"flex-end"},children:[!l&&(0,j.jsx)(t.$nd,{id:"start-logs",type:"submit",variant:"callAction",disabled:!1,onClick:()=>{e((0,a.Ib)());const s=new URL(window.location.toString()),l=s.port,n=(0,r.n)(s.protocol),t=new URL(document.baseURI).pathname;f=new WebSocket(`${n}://${s.hostname}:${l}${t}ws/console/?logType=${z}&node=${"Select node"===v?"":v}`);let i=null;if(null!==f)return f.onopen=()=>{console.log("WebSocket Client Connected"),e((0,a.xW)(!0)),f.send("ok"),i=setInterval((()=>{f.send("ok")}),1e4)},f.onmessage=s=>{let l=JSON.parse(s.data.toString()),n=!0;""===l.level&&""===l.errKind&&"00:00:00 UTC 01/01/0001"===l.time&&""===l.ConsoleMsg&&""===l.node&&(n=!1),l.key=Math.random(),C.indexOf(l.userAgent)<0&&void 0!==l.userAgent&&(C.push(l.userAgent),k(C)),n&&e((0,a.Jb)(l))},f.onclose=()=>{clearInterval(i),console.log("connection closed by server"),e((0,a.xW)(!1))},()=>{f.close(1e3),clearInterval(i),console.log("closing websockets"),e((0,a.xW)(!1))}},label:"Start Logs"}),l&&(0,j.jsx)(t.$nd,{id:"stop-logs",type:"button",variant:"callAction",onClick:()=>{null!==f&&void 0!==f&&(f.close(1e3),e((0,a.xW)(!1)))},label:"Stop Logs"})]}),(0,j.jsx)(t.xA9,{item:!0,xs:12,sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem","& button":{flexGrow:0,marginLeft:8,marginBottom:0}},children:(0,j.jsx)(c.A,{placeholder:"Filter",onChange:e=>{h(e)},value:g})}),(0,j.jsx)(t.xA9,{item:!0,xs:12,children:(0,j.jsx)(t.azJ,{id:"logs-container","data-test-id":"logs-list-container",sx:{minHeight:400,height:"calc(100vh - 200px)",overflow:"auto",fontSize:13,borderRadius:4},children:(0,j.jsxs)(t.azJ,{withBorders:!0,customBorderPadding:"0px",useBackground:!0,children:[(0,j.jsx)(t.XIK,{"aria-label":"collapsible table",children:(0,j.jsx)(t.BFY,{children:M.map((e=>(0,j.jsx)(u,{log:e})))})}),0===M.length&&(0,j.jsx)(t.azJ,{sx:{padding:20,textAlign:"center"},children:"No logs to display"})]})})})]})})]})}}}]);
//# sourceMappingURL=6164.89e6e237.chunk.js.map